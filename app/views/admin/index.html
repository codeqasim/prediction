<div class="admin-dashboard bg-gray-50 min-h-screen">
    <!-- Compact Admin Header -->
    <div class="admin-header bg-white shadow-sm border-b" ng-show="admin.isAdminAuthenticated">
        <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <div class="p-1 bg-purple-100 rounded">
                        <i class="fas fa-cog text-purple-600 text-sm"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-semibold text-gray-900">Admin Dashboard</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button ng-click="admin.refreshData()"
                            class="px-2 py-1 text-xs border border-gray-300 rounded text-gray-700 bg-white hover:bg-gray-50">
                        <i class="fas fa-sync-alt" ng-class="{'fa-spin': admin.isRefreshing}"></i>
                    </button>
                    <button ng-click="admin.adminLogout()"
                            class="px-2 py-1 text-xs border border-transparent rounded text-white bg-red-600 hover:bg-red-700">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Authentication Loading -->
    <div ng-if="!admin.isAdminAuthenticated" class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
        <div class="text-center py-6">
            <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600"></div>
            <p class="mt-2 text-gray-600 text-sm">Authenticating...</p>
        </div>
    </div>

    <!-- Loading State -->
    <div ng-if="admin.isAdminAuthenticated && admin.isLoading" class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
        <div class="text-center py-6">
            <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600"></div>
            <p class="mt-2 text-gray-600 text-sm">Loading...</p>
        </div>
    </div>

    <!-- Main Admin Content -->
    <div ng-if="admin.isAdminAuthenticated && !admin.isLoading" class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">

        <!-- Compact Stats -->
        <div class="grid grid-cols-4 gap-2 mb-3">
            <div class="bg-white rounded border p-2">
                <div class="flex items-center">
                    <div class="p-1 rounded bg-blue-50 mr-2">
                        <i class="fas fa-users text-blue-600 text-xs"></i>
                    </div>
                    <div>
                        <div class="text-xs text-gray-500">Users</div>
                        <div class="text-sm font-semibold text-gray-900">{{admin.stats.totalUsers || 0}}</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded border p-2">
                <div class="flex items-center">
                    <div class="p-1 rounded bg-green-50 mr-2">
                        <i class="fas fa-user-check text-green-600 text-xs"></i>
                    </div>
                    <div>
                        <div class="text-xs text-gray-500">Active</div>
                        <div class="text-sm font-semibold text-gray-900">{{admin.stats.activeUsers || 0}}</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded border p-2">
                <div class="flex items-center">
                    <div class="p-1 rounded bg-purple-50 mr-2">
                        <i class="fas fa-tags text-purple-600 text-xs"></i>
                    </div>
                    <div>
                        <div class="text-xs text-gray-500">Categories</div>
                        <div class="text-sm font-semibold text-gray-900">{{admin.stats.totalCategories || 0}}</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded border p-2">
                <div class="flex items-center">
                    <div class="p-1 rounded bg-indigo-50 mr-2">
                        <i class="fas fa-database text-indigo-600 text-xs"></i>
                    </div>
                    <div>
                        <div class="text-xs text-gray-500">Records</div>
                        <div class="text-sm font-semibold text-gray-900">{{admin.stats.totalRecords || 0}}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compact Tabs and Content -->
        <div class="bg-white rounded border">
            <!-- Tab Navigation -->
            <div class="border-b border-gray-200">
                <nav class="flex">
                    <button ng-repeat="tab in admin.tabs"
                            ng-click="admin.setActiveTab(tab.key)"
                            ng-class="admin.activeTab === tab.key ? 'border-purple-500 text-purple-700 bg-purple-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="flex-1 py-2 px-3 text-xs font-medium text-center border-b-2">
                        <i class="{{tab.icon}} mr-1"></i>
                        {{tab.label}}
                        <span ng-if="tab.count !== undefined"
                              ng-class="admin.activeTab === tab.key ? 'bg-purple-100 text-purple-800' : 'bg-gray-100 text-gray-600'"
                              class="ml-1 px-1.5 py-0.5 rounded text-xs">
                            {{tab.count}}
                        </span>
                    </button>
                </nav>
            </div>

            <!-- Users Tab Content -->
            <div ng-show="admin.activeTab === 'users'" class="p-3">
                <!-- Header with Search -->
                <div class="flex items-center justify-between mb-3">
                    <div class="text-sm font-medium text-gray-900">
                        Users ({{admin.filteredUsers.length}})
                    </div>
                    <div class="flex items-center space-x-2">
                        <!-- Search Input -->
                        <div class="relative">
                            <input type="text"
                                   ng-model="admin.userSearch"
                                   ng-change="admin.searchUsers()"
                                   placeholder="Search..."
                                   class="w-32 pl-6 pr-2 py-1 text-xs border border-gray-300 rounded">
                            <i class="fas fa-search absolute left-2 top-1.5 text-gray-400 text-xs"></i>
                        </div>
                        <!-- Demo Badge -->
                        <span class="px-2 py-1 text-xs bg-amber-100 text-amber-800 rounded">Demo</span>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="overflow-x-auto">
                    <table class="min-w-full border border-gray-200 rounded">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-2 py-1 text-left text-xs font-medium text-gray-500 uppercase border-b">User</th>
                                <th class="px-2 py-1 text-left text-xs font-medium text-gray-500 uppercase border-b">Status</th>
                                <th class="px-2 py-1 text-left text-xs font-medium text-gray-500 uppercase border-b">Date</th>
                                <th class="px-2 py-1 text-left text-xs font-medium text-gray-500 uppercase border-b w-32">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white">
                            <tr ng-repeat="user in admin.filteredUsers track by user.id" class="hover:bg-gray-50 border-b border-gray-100">
                                <td class="px-2 py-2">
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 rounded-full bg-purple-500 flex items-center justify-center mr-2">
                                            <span class="text-white text-xs">
                                                {{((user.user_metadata && user.user_metadata.full_name) || user.email)[0].toUpperCase()}}
                                            </span>
                                        </div>
                                        <div>
                                            <div class="text-xs font-medium text-gray-900">
                                                {{(user.user_metadata && user.user_metadata.full_name) || user.email.split('@')[0]}}
                                            </div>
                                            <div class="text-xs text-gray-500">{{user.email}}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-2 py-2">
                                    <span ng-class="user.email_confirmed_at ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'"
                                          class="px-2 py-0.5 text-xs rounded-full">
                                        {{user.email_confirmed_at ? 'Active' : 'Pending'}}
                                    </span>
                                </td>
                                <td class="px-2 py-2 text-xs text-gray-500">
                                    {{admin.formatDate(user.created_at)}}
                                </td>
                                <td class="px-2 py-2">
                                    <div class="flex items-center space-x-1">
                                        <button ng-click="admin.viewUser(user)"
                                                class="px-2 py-1 text-xs border border-gray-300 rounded text-gray-700 hover:bg-gray-50">
                                            <i class="fas fa-eye mr-1"></i>
                                            View
                                        </button>
                                        <button ng-if="user.isDeletable !== false" 
                                                ng-click="admin.deleteUser(user)"
                                                class="px-2 py-1 text-xs border border-red-300 rounded text-red-700 bg-red-50 hover:bg-red-100">
                                            <i class="fas fa-trash mr-1"></i>
                                            Delete
                                        </button>
                                        <span ng-if="user.isDeletable === false" 
                                              class="px-2 py-1 text-xs border border-blue-300 rounded text-blue-700 bg-blue-50">
                                            <i class="fas fa-user-shield mr-1"></i>
                                            Current User
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div ng-if="admin.filteredUsers.length === 0" class="text-center py-6">
                    <i class="fas fa-users text-gray-300 text-lg mb-2"></i>
                    <div class="text-sm text-gray-500">
                        <span ng-if="admin.userSearch">No users found</span>
                        <span ng-if="!admin.userSearch">No users yet</span>
                    </div>
                </div>
            </div>

            <!-- Other Tabs -->
            <div ng-show="admin.activeTab !== 'users'" class="p-3">
                <div class="text-center py-6">
                    <i class="fas fa-cog text-gray-300 text-lg mb-2"></i>
                    <div class="text-sm text-gray-500">{{admin.getActiveTabLabel()}} coming soon</div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Edit Modal -->
    <div ng-if="admin.showEditModal" class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>

            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">
                                User Details
                            </h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Full Name</label>
                                    <input type="text"
                                           ng-model="admin.editingUser.full_name"
                                           readonly
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Email</label>
                                    <input type="email"
                                           ng-model="admin.editingUser.display_email"
                                           readonly
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Status</label>
                                    <input type="text"
                                           ng-model="admin.editingUser.display_status"
                                           readonly
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Created Date</label>
                                    <input type="text"
                                           ng-model="admin.editingUser.display_created"
                                           readonly
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Last Sign In</label>
                                    <input type="text"
                                           ng-model="admin.editingUser.display_last_signin"
                                           readonly
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">User ID</label>
                                    <input type="text"
                                           ng-model="admin.editingUser.display_id"
                                           readonly
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500 font-mono text-xs">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button"
                            ng-click="admin.closeEditModal()"
                            class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div ng-if="admin.showDeleteModal" class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>

            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-exclamation-triangle text-red-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">
                                Delete User
                            </h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500">
                                    Are you sure you want to delete <strong>{{admin.userToDelete.email}}</strong>? 
                                    This action cannot be undone and will permanently remove the user from the system.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" 
                            ng-click="admin.confirmDeleteUser()" 
                            ng-disabled="admin.isDeleting"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"
                            ng-class="{'opacity-50 cursor-not-allowed': admin.isDeleting}">
                        <i ng-if="admin.isDeleting" class="fas fa-spinner fa-spin mr-2"></i>
                        {{admin.isDeleting ? 'Deleting...' : 'Delete User'}}
                    </button>
                    <button type="button" 
                            ng-click="admin.cancelDeleteUser()" 
                            ng-disabled="admin.isDeleting"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Compact Notifications -->
    <div ng-if="admin.errorMessage" class="fixed bottom-4 right-4 z-50 max-w-md">
        <div class="bg-red-50 border-l-4 border-red-400 p-3 rounded shadow-lg">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-circle text-red-400 text-sm"></i>
                </div>
                <div class="ml-2 flex-1">
                    <p class="text-sm text-red-700">{{admin.errorMessage}}</p>
                </div>
                <div class="ml-auto pl-2">
                    <button ng-click="admin.clearError()"
                            class="inline-flex text-red-400 hover:text-red-600 text-sm">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div ng-if="admin.successMessage" class="fixed bottom-4 right-4 z-50 max-w-md">
        <div class="bg-green-50 border-l-4 border-green-400 p-3 rounded shadow-lg">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-check-circle text-green-400 text-sm"></i>
                </div>
                <div class="ml-2 flex-1">
                    <p class="text-sm text-green-700">{{admin.successMessage}}</p>
                </div>
                <div class="ml-auto pl-2">
                    <button ng-click="admin.clearSuccess()"
                            class="inline-flex text-green-400 hover:text-green-600 text-sm">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
